# 🚀 **웹 네임드 인증 시스템 - 종합 시나리오 테스트 계획**

## 📊 **변수 조합 분석**

### 🔧 **핵심 변수들**
- **가입 방법**: 이메일, Google SSO, Kakao SSO
- **사용자 타입**: 일반 사용자, 관리자
- **가입 경로**: 클라이언트(`/signup`), 관리자(`/admin/signup`)
- **기존 계정 상태**: 없음, 일반 계정, 관리자 계정, 불완전 계정
- **로그인 상태**: 비로그인, 일반 로그인, 관리자 로그인
- **접근 방법**: 정상 네비게이션, URL 직접 입력, 북마크, 뒤로가기
- **브라우저 환경**: 단일 탭, 다중 탭, 다중 브라우저, 시크릿 모드
- **네트워크 상태**: 정상, 불안정, 타임아웃

---

## 🟢 **정상 시나리오 (기본 기능)**

### **S1-1. 신규 사용자 이메일 회원가입 (클라이언트)**
```
상황: 완전히 새로운 사용자
1. `/signup` 접속
2. 새 이메일 입력 → "사용 가능한 이메일" 표시
3. 정보 입력 후 회원가입
4. 이메일 인증 대기 화면
5. 이메일 인증 완료 후 로그인

예상 결과: ✅ 정상 가입 완료
```

### **S1-2. 신규 사용자 Google SSO 회원가입 (클라이언트)**
```
상황: Google 계정은 있지만 서비스 첫 이용
1. `/signup` 또는 `/login` 접속
2. "Google로 계속하기" 클릭
3. Google 인증 완료
4. OAuth 콜백에서 프로필 자동 생성
5. 홈 화면으로 이동

예상 결과: ✅ 정상 가입 및 로그인 완료
```

### **S1-3. 신규 관리자 이메일 회원가입**
```
상황: 새로운 관리자 계정 생성
1. `/admin/signup` 접속
2. 새 이메일 입력 → "새로운 관리자 계정 생성 가능" 표시
3. 정보 입력 후 관리자 회원가입
4. 이메일 인증 완료 후 관리자 로그인
5. 관리자 대시보드 접근

예상 결과: ✅ 관리자 계정 생성 완료
```

---

## 🔴 **SSO 중복 가입 시나리오 (핵심 문제)**

### **S2-1. Google SSO 클라이언트 가입 → 같은 이메일로 이메일 회원가입**
```
상황: Google로 가입한 사용자가 이메일로 다시 가입 시도
1. Google SSO로 클라이언트 회원가입 완료
2. 로그아웃
3. `/signup`에서 같은 이메일로 이메일 회원가입 시도
4. 이메일 중복 체크 → "이미 가입된 이메일" 표시

예상 결과: ✅ 중복 가입 차단, 로그인 페이지 안내
실제 위험: ❌ Supabase에서 "User already exists" 에러
```

### **S2-2. 이메일 회원가입 → 같은 이메일로 Google SSO**
```
상황: 이메일로 가입한 사용자가 Google SSO 시도
1. 이메일로 클라이언트 회원가입 완료
2. 로그아웃
3. 같은 이메일의 Google 계정으로 SSO 로그인 시도

예상 결과: ❓ 기존 계정과 연결 또는 에러
실제 위험: ❌ 계정 분리 또는 인증 실패
```

### **S2-3. Google SSO 클라이언트 가입 → 같은 이메일로 관리자 회원가입**
```
상황: Google로 가입한 사용자가 관리자 계정 생성 시도
1. Google SSO로 클라이언트 회원가입 완료
2. `/admin/signup`에서 같은 이메일 입력
3. "기존 계정을 관리자로 업그레이드" 표시
4. 업그레이드 버튼 클릭

예상 결과: ✅ 기존 계정이 관리자로 업그레이드
실제 위험: ❌ 새 계정 생성 시도 시 충돌
```

### **S2-4. 관리자 이메일 가입 → 같은 이메일로 클라이언트 Google SSO**
```
상황: 관리자로 가입한 이메일로 클라이언트에서 SSO 시도
1. 이메일로 관리자 회원가입 완료
2. 클라이언트에서 같은 이메일의 Google SSO 시도

예상 결과: ❓ 기존 관리자 계정으로 로그인
실제 위험: ❌ 권한 혼선 또는 새 계정 생성
```

---

## 🟡 **권한 전환 및 접근 제어 시나리오**

### **S3-1. 일반 사용자 로그인 → URL로 관리자 페이지 접근**
```
상황: 일반 사용자가 관리자 URL 직접 입력
1. 일반 사용자로 로그인
2. 주소창에 `/admin/events` 직접 입력
3. 권한 확인 로직 실행

예상 결과: ✅ "권한 없음" 메시지 후 홈으로 리다이렉트
실제 위험: ❌ 관리자 페이지 접근 허용
```

### **S3-2. 관리자 로그인 → 클라이언트 페이지 접근**
```
상황: 관리자가 클라이언트 페이지 접근
1. 관리자로 로그인
2. `/home` 등 클라이언트 페이지 접근

예상 결과: ✅ 정상 접근 (관리자도 일반 기능 사용 가능)
```

### **S3-3. 클라이언트 로그아웃 → 관리자 로그인**
```
상황: 같은 브라우저에서 권한 전환
1. 일반 사용자로 로그인 중
2. 로그아웃
3. `/admin/login`에서 관리자로 로그인

예상 결과: ✅ 깔끔한 상태 전환, 관리자 권한 획득
실제 위험: ❌ 이전 상태 잔여, 권한 혼선
```

### **S3-4. 다중 탭에서 다른 권한 로그인**
```
상황: 같은 브라우저의 다른 탭에서 다른 권한 로그인
1. 탭1: 일반 사용자로 로그인
2. 탭2: 새 탭에서 `/admin/login` 접속하여 관리자 로그인
3. 탭1, 탭2의 상태 확인

예상 결과: ❓ 마지막 로그인 권한이 모든 탭에 적용
실제 위험: ❌ 탭별로 다른 권한 상태, 혼란 발생
```

---

## 🔵 **데이터 불일치 시나리오**

### **S4-1. auth.users에는 있지만 user_profiles에 없는 경우**
```
상황: OAuth 로그인 후 프로필 생성 실패
1. Google SSO 로그인 성공
2. OAuth 콜백에서 프로필 생성 실패 (네트워크 오류 등)
3. auth.users에만 레코드 존재
4. 다시 로그인 시도

예상 결과: ✅ 누락된 프로필 자동 생성
실제 위험: ❌ 로그인 실패 또는 에러 발생
```

### **S4-2. user_profiles의 role과 실제 권한 불일치**
```
상황: DB 수정이나 버그로 인한 권한 불일치
1. 사용자 A가 관리자로 설정됨 (role='admin')
2. 실제로는 관리자 권한이 없어야 함
3. 관리자 페이지 접근 시도

예상 결과: ✅ 실시간 권한 검증으로 접근 차단
실제 위험: ❌ 부정 관리자 권한 획득
```

### **S4-3. 세션은 있지만 사용자 정보 없음**
```
상황: 사용자 삭제 후 세션 잔여
1. 사용자 계정 삭제 (DB에서 직접)
2. 브라우저에 세션 쿠키 잔여
3. 페이지 새로고침 또는 재접속

예상 결과: ✅ 자동 로그아웃 처리
실제 위험: ❌ 에러 발생 또는 무한 로딩
```

---

## 🟠 **네트워크 및 에러 시나리오**

### **S5-1. 회원가입 중 네트워크 중단**
```
상황: 회원가입 진행 중 연결 끊김
1. 회원가입 폼 작성 완료
2. 제출 버튼 클릭
3. 네트워크 연결 끊김
4. 연결 복구 후 재시도

예상 결과: ✅ 에러 메시지 표시, 재시도 가능
실제 위험: ❌ 중복 요청, 부분 생성 상태
```

### **S5-2. OAuth 인증 중 에러**
```
상황: Google/Kakao 인증 중 문제 발생
1. Google로 로그인 클릭
2. Google 인증 페이지에서 승인
3. 콜백 처리 중 에러 발생

예상 결과: ✅ 에러 페이지로 이동, 재시도 안내
실제 위험: ❌ 무한 리다이렉트, 빈 페이지
```

### **S5-3. 데이터베이스 연결 실패**
```
상황: Supabase 연결 문제
1. 로그인 시도
2. DB 연결 타임아웃
3. 사용자는 로딩 화면에서 대기

예상 결과: ✅ 타임아웃 후 에러 메시지, 재시도 버튼
실제 위험: ❌ 무한 로딩, 페이지 응답 없음
```

---

## 🟣 **특수 브라우저 환경 시나리오**

### **S6-1. 시크릿 모드에서 로그인**
```
상황: 프라이빗 브라우징 모드 사용
1. 시크릿 모드로 사이트 접속
2. 로그인 진행
3. 브라우저 종료 후 재접속

예상 결과: ✅ 정상 로그인, 종료 시 자동 로그아웃
```

### **S6-2. 쿠키 차단 환경**
```
상황: 브라우저에서 쿠키 차단 설정
1. 쿠키 차단 상태로 사이트 접속
2. 로그인 시도

예상 결과: ✅ 쿠키 허용 안내 메시지
실제 위험: ❌ 로그인 불가, 세션 유지 실패
```

### **S6-3. 오래된 브라우저**
```
상황: 구형 브라우저에서 접속
1. IE 또는 오래된 Safari에서 접속
2. 모던 JavaScript 기능 미지원

예상 결과: ✅ 브라우저 업그레이드 안내
실제 위험: ❌ JavaScript 에러, 페이지 깨짐
```

---

## 🔶 **악의적 시도 시나리오**

### **S7-1. CSRF 공격 시도**
```
상황: 외부 사이트에서 위조 요청
1. 악의적 사이트에서 회원가입 요청 위조
2. 사용자가 로그인 상태로 악의적 링크 클릭

예상 결과: ✅ CSRF 토큰 검증으로 차단
실제 위험: ❌ 의도하지 않은 계정 생성/수정
```

### **S7-2. XSS 시도**
```
상황: 입력 폼에 악성 스크립트 삽입
1. 이름이나 소개글에 <script> 태그 포함
2. 다른 사용자가 해당 프로필 조회

예상 결과: ✅ 입력값 이스케이핑으로 차단
실제 위험: ❌ 스크립트 실행, 정보 탈취
```

### **S7-3. SQL Injection 시도**
```
상황: 입력값에 SQL 코드 삽입
1. 이메일 필드에 SQL 코드 입력
2. 데이터베이스 조회 시 실행 시도

예상 결과: ✅ 파라미터화 쿼리로 차단
실제 위험: ❌ DB 정보 노출, 데이터 조작
```

---

## 🎯 **복합 시나리오 (실제 사용자 패턴)**

### **S8-1. 헷갈린 사용자의 다중 가입 시도**
```
상황: 사용자가 자신의 가입 여부를 잊음
1. 1개월 전 Google SSO로 가입했으나 기억 못함
2. 이메일로 회원가입 시도
3. "이미 가입된 이메일" 메시지 확인
4. 로그인 페이지로 이동하여 Google SSO 로그인

예상 결과: ✅ 명확한 안내로 기존 계정 복구
```

### **S8-2. 관리자 권한 요청 사용자**
```
상황: 일반 사용자가 관리자 권한 필요
1. 일반 사용자로 가입/로그인 완료
2. 관리자 기능 필요 발생
3. `/admin/signup`에서 업그레이드 시도

예상 결과: ✅ 기존 계정 관리자 업그레이드 성공
```

### **S8-3. 회사에서 개인 계정 혼용**
```
상황: 회사에서 개인 Google 계정 사용
1. 개인 Google 계정으로 회사에서 로그인
2. 퇴근 후 집에서 같은 계정 접속
3. 다른 디바이스에서 동시 접속

예상 결과: ✅ 멀티 디바이스 세션 관리
실제 위험: ❌ 세션 충돌, 로그아웃 발생
```

---

## 📋 **테스트 우선순위**

### **🔴 Critical (즉시 해결 필요)**
1. S2-1, S2-3: SSO 중복 가입 시나리오
2. S3-1: 권한 우회 접근
3. S4-1: 프로필 누락 상황

### **🟡 High (주요 기능)**
1. S3-3, S3-4: 권한 전환 시나리오
2. S5-1, S5-2: 네트워크 에러 처리
3. S8-1, S8-2: 실제 사용자 패턴

### **🟢 Medium (안정성)**
1. S6-1, S6-2: 브라우저 호환성
2. S4-2, S4-3: 데이터 정합성
3. S5-3: DB 연결 실패

### **🔵 Low (보안 강화)**
1. S7-1, S7-2, S7-3: 보안 공격 대응
2. S6-3: 구형 브라우저 지원
3. S8-3: 멀티 디바이스 관리

---

## 🛠️ **각 시나리오별 해결 방안**

각 시나리오는 다음과 같은 방식으로 해결:

1. **예방적 조치**: 사전 검증 로직 강화
2. **감지 및 복구**: 문제 상황 자동 감지 후 복구
3. **사용자 안내**: 명확한 에러 메시지와 해결 방법 제시
4. **모니터링**: 로그 수집 및 알림 시스템 구축

이제 이 시나리오들을 하나씩 실제로 테스트하고 문제점을 발견하여 개선해나가야 합니다.